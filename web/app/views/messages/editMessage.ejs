<% include ../inc/header %>

<div class="ui grid" ng-controller="AddMessageController">

  <div class="three wide column"><p></p></div>

  <div class="twelve wide column">

    <div class="ui blue segment">
      <h1 class="ui header"><%= title %></h1>
      <form ng-submit="sauvegarder()" class="ui form">
        <div class="field">
          <label>Objet du message</label>
          <input type="text" ng-model="message.titre" name="title" value="" placeholder="Entrer un objet">
        </div>
        <div class="field">
          <label>Type de message</label>
          <select name="type" ng-model="message.type" class="ui fluid dropdown">
            <option value="">-- Choisir un type de message --</option>
            <option value="beacon">Beacon</option>
            <option value="push">Push</option>
          </select>
        </div>
        <div class="field" ng-if="message.type == 'beacon'">
          <label>Beacons concern√©</label>
          <select type="text" class="ui fluid search dropdown" multiple ng-model="message.beacons" ng-dropdown ng-dropdown-values="beaconList" ng-options="beacon.UUID as beacon.nom for beacon in beaconList">
            <option value="">Choisir un ou plusieurs beacons</option>
          </select>
        </div>
        <div class="two fields">
          <div class="field">
            <label>A partir du</label>
            <input ng-model="message.fromdate" name="fromdate" class="datepicker" >
          </div>
          <div class="field">
            <label>jusqu'au</label>
            <input ng-model="message.todate" name="todate" class="datepicker" >
          </div>
        </div>
        <div class="field">
          <label>Destinataire</label>
          <div class="inline fields">
            <div class="ui simple dropdown item">
              <i class="users circular link icon "></i>
              <div class="menu">
                <div class="header ui input" style="margin-left: 0; margin-right: 0; ">
                  <input type="text" placeholder="Filtrer...">
                </div>
                <div class="divider"></div>
                <div class="header">Liste de diffusions</div>
                <div class="item" ng-repeat="contact in users">
                  <div class="ui checkbox">
                    <input type="checkbox" id="{{contact._id}}" class="hidden" checklist-model="message.destinataires" checklist-value="contact._id" ng-checked="userIsInSelectedGroup(contact.groupes)">
                    <label for="{{contact._id}}">{{contact.firstName}} {{contact.lastName}}</label>
                  </div>
                </div>
              </div>
            </div>
            <select type="text" class="ui fluid search dropdown" multiple ng-model="groupeSelected" ng-dropdown ng-dropdown-values="groupes" ng-options="groupe._id as groupe._id for groupe in groupes" ng-change="selectUsers()">
              <option value="">Destinataire</option>
            </select>
          </div>

        </div>

        <div class="field">
          <label>Contenu du message</label>
          <textarea name="content" ckeditor="{}"  ng-model="message.content"></textarea>
        </div>

        <div class="field">
          <input class="ui green button" type="submit" value="Enregistrer">
        </div>
      </form>
    </div>

    <div class="ui segment">
      <h2 class="ui header">Preview</h2>
      <p class="ui message" ng-bind-html="message.content"></p>
    </div>
  </div>

  <div class="one wide column"><p></p></div>
</div>

<% include ../inc/footer %>
